package phoenix.api.annotation;

import org.springframework.stereotype.Component;

import java.lang.annotation.*;
import java.util.Arrays;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.stream.Collectors;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Component
public @interface Plugin {

    String id();

    String name();

    String description() default "";

    int[] version() default { 1, 0, 0 };

    String author() default "";

    Icon icon() default @Icon(width = 512, height = 512, path = {
      @Path(d = "M239.5 2.66C237.3 2.84 231.22 3.47 226 4.06C220.78 4.65 210.88 6.27 204 7.67C197.13 9.07 185.88 12.02 179 14.23C172.13 16.43 161.32 20.46 155 23.17C148.68 25.88 139 30.62 133.5 33.69C128 36.76 119.67 41.84 115 44.98C110.33 48.12 102 54.31 96.5 58.75C91 63.18 81.68 71.69 75.78 77.66C69.88 83.62 61.83 92.55 57.88 97.5C53.93 102.45 48.14 110.33 45.03 115C41.91 119.67 37.05 127.55 34.22 132.5C31.39 137.45 27.08 146 24.65 151.5C22.21 157 18.57 166.22 16.54 172C14.52 177.78 11.58 187.45 10 193.5C8.43 199.55 6.14 211.03 4.91 219C3.12 230.63 2.67 237.85 2.64 255.5C2.62 271.37 3.1 280.84 4.36 289.5C5.32 296.1 7.17 306.23 8.47 312C9.77 317.77 12.5 327.68 14.54 334C16.58 340.32 20.47 350.68 23.18 357C25.89 363.32 30.62 373 33.69 378.5C36.76 384 41.85 392.32 44.99 397C48.14 401.68 53.55 409.1 57.01 413.5C60.48 417.9 68.53 426.83 74.91 433.35C81.28 439.86 91 448.82 96.5 453.25C102 457.69 110.33 463.87 115 466.99C119.67 470.1 128 475.19 133.5 478.28C139 481.38 148.68 486.12 155 488.83C161.32 491.54 171.68 495.42 178 497.46C184.32 499.5 194.22 502.23 200 503.53C205.78 504.82 215.45 506.57 221.5 507.41C227.55 508.25 238.8 509.23 246.5 509.6C254.88 510 266.12 509.79 274.5 509.08C282.2 508.42 293.9 506.97 300.5 505.85C307.1 504.72 317.68 502.32 324 500.5C330.32 498.69 340 495.54 345.5 493.51C351 491.48 361.35 486.95 368.5 483.44C375.65 479.93 386.45 473.84 392.5 469.91C398.55 465.98 407.32 459.8 412 456.17C416.68 452.55 426.06 444.17 432.86 437.54C439.66 430.92 448.84 421 453.27 415.5C457.69 410 463.88 401.68 467.02 397C470.16 392.32 475.24 384 478.31 378.5C481.38 373 486.11 363.32 488.82 357C491.53 350.68 495.42 340.32 497.46 334C499.5 327.68 502.23 317.77 503.53 312C504.83 306.23 506.67 296.1 507.63 289.5C508.87 281.01 509.38 271.21 509.38 256C509.38 240.79 508.87 230.99 507.63 222.5C506.67 215.9 504.83 205.78 503.53 200C502.23 194.22 499.5 184.32 497.46 178C495.42 171.68 491.53 161.32 488.82 155C486.11 148.68 481.38 139 478.31 133.5C475.24 128 470.16 119.67 467.02 115C463.88 110.33 457.69 102 453.27 96.5C448.84 91 439.66 81.08 432.86 74.46C426.06 67.83 416.68 59.45 412 55.83C407.32 52.2 398.55 46.02 392.5 42.09C386.45 38.16 375.65 32.07 368.5 28.56C361.35 25.05 351 20.52 345.5 18.49C340 16.46 330.32 13.31 324 11.49C317.68 9.68 306.88 7.25 300 6.1C293.13 4.95 282.32 3.56 276 3.02C269.68 2.47 259.77 2.09 254 2.18C248.22 2.26 241.7 2.48 239.5 2.66Z", fill = "#4b83c1"),
      @Path(d = "M238.5 120.66C234.65 121.49 228.13 123.47 224 125.06C219.88 126.65 212.9 130.3 208.5 133.17C204.1 136.04 197.77 141.11 194.44 144.44C191.1 147.78 186.4 153.43 184 157C181.59 160.57 178.36 166.31 176.81 169.75C175.26 173.19 173.09 179.26 171.97 183.25C170.86 187.24 169.66 194.55 169.3 199.5C168.78 206.55 168.99 209.48 170.26 213C171.19 215.57 173.62 219.11 175.94 221.25C178.17 223.31 181.69 225.45 183.75 225.99C185.81 226.54 188.63 226.99 190 226.99C191.38 226.99 194.19 226.54 196.25 225.99C198.31 225.45 201.65 223.54 203.66 221.75C205.68 219.96 208.14 216.7 209.14 214.5C210.14 212.3 210.97 208.59 210.98 206.25C210.99 203.91 211.5 199.64 212.11 196.75C212.73 193.86 214.27 189.25 215.54 186.5C216.8 183.75 219.83 179.25 222.26 176.5C224.68 173.75 228.88 170.05 231.59 168.28C234.29 166.51 239.2 164.12 242.5 162.96C246.26 161.65 251.11 160.84 255.5 160.8C259.38 160.76 265.18 161.51 268.5 162.47C271.8 163.43 276.07 165 278 165.98C279.93 166.95 284.13 170.17 287.35 173.12C291.42 176.86 294.25 180.64 296.62 185.5C298.5 189.35 300.49 195.2 301.03 198.5C301.58 201.8 301.73 206.97 301.37 210C301.01 213.03 299.96 217.75 299.03 220.5C298.11 223.25 295.58 228.16 293.42 231.42C291.27 234.67 287.7 238.79 285.5 240.56C283.3 242.33 276.77 246.13 271 249.02C262.34 253.34 259.18 255.6 252.97 261.88C248.64 266.26 244.1 272.05 242.3 275.5C240.58 278.8 238.47 284.2 237.62 287.5C236.77 290.8 235.78 297.77 235.41 303C234.97 309.35 235.17 314.49 236.03 318.5C237.03 323.2 238.2 325.44 241.4 328.82C244.47 332.06 246.89 333.53 251 334.67C255.64 335.94 257.29 335.98 261.5 334.91C264.6 334.11 267.98 332.28 270.4 330.06C272.55 328.1 274.98 324.93 275.81 323C276.69 320.95 277.56 314.71 277.91 307.93C278.44 297.5 278.76 296.01 281.1 292.93C282.87 290.59 286.83 287.96 293.6 284.64C299.04 281.96 305.98 277.86 309 275.51C312.02 273.17 316.77 268.83 319.55 265.87C322.32 262.92 325.99 258.48 327.69 256C329.39 253.53 332.36 248.35 334.29 244.5C336.22 240.65 338.73 234.35 339.86 230.5C341 226.65 342.39 219.45 342.95 214.5C343.59 208.79 343.63 202.58 343.06 197.5C342.56 193.1 341.59 187.25 340.9 184.5C340.21 181.75 338.58 176.8 337.29 173.5C335.99 170.2 332.82 164.13 330.24 160C327.66 155.88 322.39 149.31 318.52 145.42C314.66 141.52 308.8 136.52 305.5 134.31C302.2 132.09 297.48 129.25 295 128C292.52 126.74 288.02 124.85 285 123.81C281.98 122.76 276.46 121.25 272.75 120.45C269.04 119.65 261.39 119.04 255.75 119.08C250.11 119.13 242.35 119.84 238.5 120.66ZM247.5 352.9C245.3 353.91 242.29 356.04 240.8 357.62C239.32 359.21 237.41 362.19 236.55 364.25C235.7 366.31 235.01 369.91 235.02 372.25C235.03 374.59 235.88 378.3 236.9 380.5C237.91 382.7 240.04 385.71 241.62 387.2C243.21 388.68 246.19 390.59 248.25 391.45C250.31 392.3 253.8 393 256 393C258.2 393 261.69 392.3 263.75 391.45C265.81 390.59 268.79 388.68 270.38 387.2C271.96 385.71 274.09 382.7 275.1 380.5C276.12 378.3 276.96 374.48 276.96 372C276.96 369.52 276.12 365.7 275.1 363.5C274.09 361.3 271.96 358.29 270.38 356.8C268.79 355.32 265.81 353.41 263.75 352.55C261.69 351.7 258.09 351.01 255.75 351.02C253.41 351.03 249.7 351.88 247.5 352.9Z", fill = "#ffffff")
    });

    class Container {

        private final Plugin annotation;
        private final Object instance;

        public Container(Plugin annotation, Object instance) {
            this.instance = instance;
            this.annotation = annotation;

            Pattern p = Pattern.compile("[^A-Za-z0-9-_]");
            Matcher m = p.matcher(this.getData().id());

            boolean b = m.find();
            if (b) throw new IllegalArgumentException("Invalid plugin id: \"" + this.getData().id() + "\"! It can't contain any special characters.");
        }

        public Object getInstance() {
            return instance;
        }

        @SuppressWarnings("unchecked")
        public <T> T get() {
            return (T) this.instance;
        }

        public Plugin getData() {
            return this.annotation;
        }

        public String version() {
            return Arrays.stream(getData().version())
                    .mapToObj(String::valueOf)
                    .collect(Collectors.joining("."));
        }

    }

    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.TYPE)
    @interface Component { }

    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.TYPE)
    @interface Repository { }

}
